<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NIU PLAY</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    
    <style>
        /* --- ESTILOS GENERALES --- */
        :root {
            --primary: #E50914;
            --dark: #141414;
            --gray: #333;
            --light: #fff;
        }

        body { 
            background-color: var(--dark); 
            color: var(--light); 
            font-family: 'Poppins', sans-serif; 
            margin: 0; padding: 0;
        }

        /* --- CABECERA --- */
        header {
            padding: 20px;
            position: sticky; top: 0; z-index: 100;
            background: linear-gradient(to bottom, rgba(0,0,0,0.9) 0%, rgba(0,0,0,0.7) 100%);
            backdrop-filter: blur(5px);
        }

        .header-top {
            display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;
        }

        h1 { margin: 0; color: var(--primary); font-size: 28px; letter-spacing: 2px; }

        #buscador {
            background: var(--gray); border: 1px solid #444; color: white;
            padding: 8px 15px; border-radius: 20px; width: 200px;
            transition: width 0.3s;
        }
        #buscador:focus { width: 100%; outline: none; border-color: var(--primary); }

        /* --- PESTAÑAS DE CATEGORÍA --- */
        .tabs {
            display: flex; gap: 10px; overflow-x: auto; padding-bottom: 5px;
            /* Ocultar barra de scroll */
            scrollbar-width: none; 
        }
        .tabs::-webkit-scrollbar { display: none; }

        .tab-btn {
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            color: #ddd;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            white-space: nowrap;
            font-size: 14px;
            transition: all 0.3s;
        }

        .tab-btn:hover { background: rgba(255,255,255,0.2); }
        
        .tab-btn.activo {
            background: var(--light);
            color: var(--dark);
            font-weight: 600;
            border-color: var(--light);
        }

        /* --- GRILLA --- */
        .contenedor-principal { padding: 20px; max-width: 1200px; margin: 0 auto; }
        .galeria { 
            display: grid; 
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); 
            gap: 15px; 
        }

        /* --- TARJETAS --- */
        .tarjeta { 
            position: relative; border-radius: 6px; overflow: hidden; 
            cursor: pointer; transition: transform 0.2s; aspect-ratio: 2/3;
            background: #222;
        }
        .tarjeta:hover { transform: scale(1.05); z-index: 10; box-shadow: 0 0 15px rgba(229,9,20,0.5); }
        
        .tarjeta img { width: 100%; height: 100%; object-fit: cover; }
        
        .titulo-overlay {
            position: absolute; bottom: 0; left: 0; right: 0;
            background: linear-gradient(transparent, black);
            padding: 10px; font-size: 13px; text-align: center;
        }

        /* Etiqueta de tipo (TV/Peli) */
        .badge {
            position: absolute; top: 5px; right: 5px;
            background: rgba(0,0,0,0.6); padding: 2px 6px;
            border-radius: 4px; font-size: 10px; font-weight: bold;
            color: #ccc; border: 1px solid #555;
        }
    </style>
</head>
<body>

    <header>
        <div class="header-top">
            <h1>NIU PLAY</h1>
            <input type="text" id="buscador" placeholder="Buscar...">
        </div>
        
        <div class="tabs">
            <button class="tab-btn activo" onclick="cambiarCategoria('TODO')">Todo</button>
            <button class="tab-btn" onclick="cambiarCategoria('TV')">TV en Vivo</button>
            <button class="tab-btn" onclick="cambiarCategoria('PELICULA')">Películas</button>
            <button class="tab-btn" onclick="cambiarCategoria('RADIO')">Radio</button>
        </div>
    </header>

    <div class="contenedor-principal">
        <div class="galeria" id="contenedor-peliculas"></div>
        <div id="sin-resultados" style="display:none; text-align:center; margin-top:50px; color:#666;">
            <p>No hay contenido en esta categoría.</p>
        </div>
    </div>

    <script>
        const contenedor = document.getElementById('contenedor-peliculas');
        const buscador = document.getElementById('buscador');
        let peliculasDB = [];
        let categoriaActual = 'TODO';

        // 1. CARGAR DATOS
        fetch('peliculas.json')
            .then(res => res.json())
            .then(data => {
                peliculasDB = data;
                renderizar();
            })
            .catch(err => console.error("Error cargando JSON:", err));

        // 2. FUNCIÓN PRINCIPAL DE RENDERIZADO
        function renderizar() {
            contenedor.innerHTML = '';
            const textoBusqueda = buscador.value.toLowerCase();

            // Filtramos por Categoría Y por Texto al mismo tiempo
            const filtrados = peliculasDB.filter(item => {
                // Si la categoría es TODO, pasa. Si no, debe coincidir.
                // Si el item no tiene categoría definida, lo mostramos en TODO o en TV por defecto
                const catItem = item.categoria ? item.categoria.toUpperCase() : 'OTROS';
                const pasaCategoria = (categoriaActual === 'TODO') || (catItem === categoriaActual);
                
                // Filtro de texto
                const pasaTexto = item.titulo.toLowerCase().includes(textoBusqueda);

                return pasaCategoria && pasaTexto;
            });

            // Mostrar mensaje si está vacío
            document.getElementById('sin-resultados').style.display = filtrados.length === 0 ? 'block' : 'none';

            // Dibujar tarjetas
            filtrados.forEach(item => {
                const card = document.createElement('div');
                card.className = 'tarjeta';
                card.onclick = () => window.location.href = `reproductor.html?video=${encodeURIComponent(item.url)}&titulo=${encodeURIComponent(item.titulo)}`;
                
                // Ponemos una imagen por defecto si falla
                const img = item.foto || 'https://via.placeholder.com/200x300?text=NIU+PLAY';
                
                card.innerHTML = `
                    <div class="badge">${item.categoria || ''}</div>
                    <img src="${img}" loading="lazy" alt="${item.titulo}">
                    <div class="titulo-overlay">${item.titulo}</div>
                `;
                contenedor.appendChild(card);
            });
        }

        // 3. CAMBIAR CATEGORÍA (Click en botones)
        function cambiarCategoria(nuevaCat) {
            categoriaActual = nuevaCat;
            
            // Actualizar estilo de botones (Poner blanco el activo)
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('activo');
                if(btn.innerText.toUpperCase().includes(nuevaCat === 'TODO' ? 'TODO' : nuevaCat) || 
                   (nuevaCat === 'TV' && btn.innerText.includes('TV')) ||
                   (nuevaCat === 'PELICULA' && btn.innerText.includes('Películas')) ||
                   (nuevaCat === 'RADIO' && btn.innerText.includes('Radio'))) {
                    btn.classList.add('activo');
                }
            });
            
            // Volver a pintar
            renderizar();
        }

        // 4. ESCUCHAR EL BUSCADOR
        buscador.addEventListener('input', renderizar);

    </script>
</body>
</html>
